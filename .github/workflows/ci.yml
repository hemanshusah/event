name: Basic CI/CD Pipeline

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main, develop ]

jobs:
  # Simple validation job - no complex dependencies
  validate:
    name: Validate Project
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'

      - name: Check project structure
        run: |
          echo "🔍 Checking project structure..."
          echo "Root directory contents:"
          ls -la
          echo ""
          echo "Backend structure:"
          ls -la backend/api-gateway/
          echo ""
          echo "Web admin structure:"
          ls -la web-admin/
          echo ""
          echo "Mobile structure:"
          ls -la mobile-apps/ios/
          echo "✅ Project structure is valid"

      - name: Check package.json files exist
        run: |
          echo "📦 Checking package.json files..."
          test -f package.json && echo "✅ Root package.json exists"
          test -f backend/api-gateway/package.json && echo "✅ Backend package.json exists"
          test -f web-admin/package.json && echo "✅ Web admin package.json exists"
          test -f mobile-apps/ios/package.json && echo "✅ Mobile package.json exists"
          echo "✅ All package.json files found"

      - name: Check main source files exist
        run: |
          echo "🔍 Checking main source files..."
          test -f backend/api-gateway/src/server.js && echo "✅ Backend server.js exists"
          test -f web-admin/src/App.js && echo "✅ Web admin App.js exists"
          test -f mobile-apps/ios/App.js && echo "✅ Mobile App.js exists"
          echo "✅ All main source files exist"

      - name: Check routes and pages exist
        run: |
          echo "🔍 Checking routes and pages..."
          echo "Backend routes:"
          ls -la backend/api-gateway/src/routes/
          echo "Web admin pages:"
          ls -la web-admin/src/pages/
          echo "Mobile screens:"
          ls -la mobile-apps/ios/src/screens/
          echo "✅ All routes and pages exist"

      - name: Validate file syntax (basic)
        run: |
          echo "🔍 Validating file syntax..."
          echo "Checking backend server file:"
          node -c backend/api-gateway/src/server.js && echo "✅ Backend syntax valid"
          echo "Checking web admin app file:"
          node -c web-admin/src/App.js && echo "✅ Web admin syntax valid"
          echo "Checking mobile app file:"
          node -c mobile-apps/ios/App.js && echo "✅ Mobile syntax valid"
          echo "✅ All file syntax is valid"

      - name: Check database schema exists
        run: |
          echo "🔍 Checking database files..."
          test -f database/schemas/01_create_tables.sql && echo "✅ Database schema exists"
          test -f database/seeds/01_initial_data.sql && echo "✅ Database seeds exist"
          echo "✅ Database files exist"

      - name: Check Docker files exist
        run: |
          echo "🔍 Checking Docker files..."
          test -f backend/api-gateway/Dockerfile && echo "✅ Backend Dockerfile exists"
          test -f web-admin/Dockerfile && echo "✅ Web admin Dockerfile exists"
          test -f docker-compose.yml && echo "✅ Docker compose exists"
          echo "✅ Docker files exist"

      - name: Check documentation exists
        run: |
          echo "🔍 Checking documentation..."
          test -f README.md && echo "✅ README exists"
          test -f DEVELOPMENT.md && echo "✅ Development docs exist"
          test -f DEPLOYMENT.md && echo "✅ Deployment docs exist"
          echo "✅ Documentation exists"

      - name: Success message
        run: |
          echo "🎉 CI/CD Pipeline completed successfully!"
          echo "✅ Project structure validated"
          echo "✅ All source files exist"
          echo "✅ File syntax is valid"
          echo "✅ Database schema exists"
          echo "✅ Docker configuration exists"
          echo "✅ Documentation exists"
          echo "✅ Ready for development"